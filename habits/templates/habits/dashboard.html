<!DOCTYPE html>
<html>
<head>
    <title>Habit Dashboard</title>
</head>
<body>

<h1>Habit Dashboard</h1>
<p>Welcome, {{ request.user.username }}</p>

<a href="{% url 'habit_create' %}">â• Add Habit</a>

<form method="post" action="{% url 'logout' %}">
    {% csrf_token %}
    <button type="submit">Logout</button>
</form>

<hr>

{% if has_burnout_risk %}
<p style="color:red;">
âš ï¸ You are at risk of burnout. Consider reducing intensity.
</p>
{% endif %}

<h2>ğŸ”¥ Discipline Score: {{ total_score }}</h2>

<h2>ğŸ“Š Consistency Index (30 days): {{ consistency_score }}%</h2>
{% if consistency_score >= 80 %}
ğŸŸ¢ Excellent
{% elif consistency_score >= 50 %}
ğŸŸ¡ Moderate
{% else %}
ğŸ”´ Needs Work
{% endif %}

<h3>ğŸ“ˆ Last 7 Days</h3>
<ul>
{% for day in daily_scores %}
    <li>{{ day.date }} â€” <strong>{{ day.score }}</strong></li>
{% endfor %}
</ul>

<p>
Trend:
{% if trend == "improving" %}
ğŸ“ˆ Improving
{% elif trend == "declining" %}
ğŸ“‰ Declining
{% else %}
â– Stable
{% endif %}
</p>

<hr>

<h2>Your Habits</h2>

<ul>
{% for habit in habits %}
<li style="list-style:none; margin-bottom:20px;">
    <strong>{{ habit.name }}</strong><br>

    ğŸ§  Insight: {{ habit.insight_label }}<br>
    ğŸ”¥ Streak: {{ habit.current_streak }} day{{ habit.current_streak|pluralize }}<br>

    {% if habit.missed_days %}
        âš ï¸ Missed {{ habit.missed_days }} day{{ habit.missed_days|pluralize }}<br>
    {% endif %}

    {% if habit.last_completed_date %}
        ğŸ“… Last done: {{ habit.last_completed_date }}<br>
    {% else %}
        âŒ Never completed<br>
    {% endif %}

    <div style="width:220px;background:#ddd;height:10px;">
        <div style="width:{{ habit.streak_percentage }}%;height:10px;background:green;"></div>
    </div>

    {% if habit.id in completed_habits %}
        âœ… Done today
    {% else %}
        <a href="{% url 'habit_complete' habit.id %}">Mark Done</a>
    {% endif %}
</li>
{% empty %}
<li>No habits yet.</li>
{% endfor %}
</ul>

</body>
</html>
